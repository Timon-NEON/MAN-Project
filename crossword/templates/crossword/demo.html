{% extends 'crossword/layout.html' %}
{% load static %}

{% block body %}
    {% if user_status == '0' %}
    <div>
        <h1>
            {{ crossword_name }}
        </h1>
    </div>
    <div>
        <form action="{% url 'main:index' %}" method="post">
            {% csrf_token %}
            <h3>name</h3>
            {{ form.name }}
            <h3>words</h3>
            {{ form.words }}
            <br><br>
            <input type="submit" value="Remaking!">
        </form>
    </div>

    {% if is_owner %}
        <form action="{% url 'main:delete' crossword_link %}" method="post">
            {% csrf_token %}
            <input type="submit" value="Delete">
        </form>
    {% endif %}

    <div>
        <h4>Here demo</h4>
        <br>
        <div class="demo-image">
            <img width="400" src="/media/images/full_crossword_{{ show_demo }}.png" alt="demo crossword">
        </div>
    </div>

    <div>
        {% if draw_form %}
            <form action="{% url 'main:draw' 'demo' %}" method="get">
                {% csrf_token %}
                {{ draw_form }}
                <input type="submit" value="Draw">
            </form>
        {% endif %}
    </div>

    <div>
        {% if download %}
        <img src="" data-download="/media/images/clear_crossword_{{ download }}.png" alt="Clear {{crossword_name}} crossword" style="display: none;">
        <img src="" data-download="/media/images/full_crossword_{{ download }}.png" alt="Full {{crossword_name}} crossword" style="display: none;">
        <img src="" data-download="/media/images/describe_list_{{ download }}.png" alt="Describe {{crossword_name}} list" style="display: none;">
        <button id="download-images">Завантажити зображення</button>
        {% endif %}
    </div>

    {% else %}
        <div>
            <h1>
                {{ crossword_name }}
            </h1>
        </div>

        <div>
            <h4>Here demo</h4>
            <br>
            <div class="demo-image">
                <img width="400" src="/media/images/clear_crossword_{{ show_demo }}.png" alt="demo crossword">
            </div>
        </div>

        <div>
            {% if draw_form %}
                <form action="{% url 'main:draw' 'demo' %}" method="get">
                    {% csrf_token %}
                    {{ draw_form }}
                    <input type="submit" value="Draw">
                </form>
            {% endif %}
        </div>

        <div>
            {% if download %}
            <img src="" data-download="/media/images/clear_crossword_{{ download }}.png" alt="Clear {{crossword_name}} crossword" style="display: none;">
            <img src="" data-download="/media/images/describe_list_{{ download }}.png" alt="Describe {{crossword_name}} list" style="display: none;">
            <button id="download-images">Завантажити зображення</button>
            {% endif %}
        </div>
    {% endif %}

    <script>
        const button = document.getElementById("download-images");
    
        button.addEventListener("click", () => {
          const images = document.querySelectorAll("img[data-download]");
    
          for (const image of images) {
            const xhr = new XMLHttpRequest();
    
            xhr.open("GET", image.getAttribute("data-download"));
            xhr.responseType = "blob";
    
            xhr.onload = () => {
              const blob = xhr.response;
              const url = window.URL.createObjectURL(blob);
    
              const link = document.createElement("a");
              link.href = url;
              link.download = image.getAttribute("alt");
    
              document.body.appendChild(link);
              link.click();
            };
    
            xhr.send();
          }
        });
      </script>
{% endblock %}